{% extends 'base.html' %}
{% load static %}
{% load social_share %}
{% block title %}{{ post.pk }}{% endblock title %}

{% block meta_head %}
    <meta name="description" content="Sociala, social media, social network, social platform">
    <meta name='author' content="Abdelrahman Abobakr">
    <meta property="og:site_name" content="Sociala">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:title" content="{% if post.caption %}{{ post.caption }}{% else %}{{ post.body|truncatechars:60 }}{% endif %}">
    <meta property="og:description" content="{% if post.caption %}{{ post.caption }}{% else %}{{ post.body|truncatechars:100 }}{% endif %} by {{ post.user.username }}">
    {% if post.media.all %}<meta property="og:image" content="{{ request.build_absolute_uri|cut:request.path|add:post.media.all.0.file.url }}">{% endif %}

    <style>
        .post-media-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            width: 100%;
            overflow: hidden;
        }
        .post-media-wrapper img,
        .post-media-wrapper video {
            max-width: 100%;
            max-height: 340px;
            width: auto;
            height: auto;
            border-radius: 12px;
            object-fit: cover;
            display: block;
            margin: 0 auto;
            background: #f4f6fb;
        }
        .login-prompt {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }
        .login-prompt a {
            color: #007bff;
            text-decoration: none;
            font-weight: 600;
        }
        .login-prompt a:hover {
            text-decoration: underline;
        }
    </style>
{% endblock meta_head %}
    
{% block body %}
    <div class="main-content right-chat-active">
        <div class="middle-sidebar-bottom">
            <div class="middle-sidebar-left pe-0 ps-lg-3 ms-0 me-0" style="max-width: 100%;">
                <div class="col">
                    <div class="card w-100 shadow-xss rounded-xxl border-0 p-4">
                        <div class="card-body p-0 d-flex">
                            <figure class="avatar me-3"><img src="{{ request.build_absolute_uri|cut:request.path|add:post.user.img.url }}" alt="image" class="shadow-sm rounded-circle w45"></figure>
                            <h4 class="fw-700 text-grey-900 font-xssss mt-1">{{ post.user.username }} 
                                {% if post.user.verified %}
                                    <i class="feather-check bg-success font-xs" style='border-radius:50px;'></i>
                                {% endif %}
                                {% if post.user.is_admin %}
                                    <i class="feather-check  font-xs" style='border-radius:50px; background-color: #FDD017'></i>
                                {% endif %}
                                <span class="d-block font-xssss fw-500 mt-1 lh-3 text-grey-500">{{ post.created_at|timesince }} ago</span></h4>
                        </div>
                        
                        {% if post.body %}
                            <div class="card-body p-0 me-lg-5">
                                <p class="fw-500 text-grey-500 lh-26 font-xssss w-100">{{post.body}}</p>
                            </div>
                        {% else %}
                            {% if post.caption %}
                                <div class="card-body p-0 me-lg-5">
                                    <p class="fw-500 text-grey-500 lh-26 font-xssss w-100">{{post.caption}}</p>
                                </div>
                            {% endif %}

                            {% for i in post.media.all %}
                                <div class="post-media-wrapper">
                                    {% if i.content_type == 'image' %}
                                        <a href="{{ request.build_absolute_uri|cut:request.path|add:i.file.url }}" data-lightbox="roadtri"><img src="{{ request.build_absolute_uri|cut:request.path|add:i.file.url }}" alt="image"></a>
                                    {% elif i.content_type == 'video' %}
                                        <video controls>
                                            <source src="{{ request.build_absolute_uri|cut:request.path|add:i.file.url }}" type="video/mp4">
                                        </video>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        {% endif %}

                        <div class="card-body d-flex p-0">
                            <span class="d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss me-3">
                                <i class="feather-thumbs-up text-white bg-primary-gradiant me-1 btn-round-xs font-xss"></i> {{post.like_count}} Like
                            </span>
                            <span class="d-flex align-items-center fw-600 text-grey-900 text-dark lh-26 font-xssss">
                                <i class="feather-message-circle text-dark text-grey-900 btn-round-sm font-lg"></i> {{ post.comments.all.count }} Comment
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Login prompt for public viewers -->
                <div class="login-prompt">
                    <h5>Want to see more?</h5>
                    <p>Join Sociala to like, comment, and share posts!</p>
                    <a href="{% url 'account_login' %}" class="btn btn-primary">Login</a>
                    <a href="{% url 'account_signup' %}" class="btn btn-outline-primary ms-2">Sign Up</a>
                </div>

                <!-- Show comments (read-only for public viewers) -->
                <div class="row">
                    <div class="col-lg-12 position-relative">
                        <div class="chat-wrapper pt-0 w-100 position-relative scroll-bar bg-white theme-dark-bg">
                            <div class="chat-body p-3 ">
                                <div id="comments-{{ post.id }}" class="messages-content pb-5">
                                    {% for i in comments %}
                                        <div class="comment-item d-flex mb-3">
                                            <figure class="avatar me-3">
                                                <img src="{{ request.build_absolute_uri|cut:request.path|add:i.user.img.url }}" alt="image" class="shadow-sm rounded-circle w35">
                                            </figure>
                                            <div class="comment-content bg-lightblue rounded-xxl p-2 w-100">
                                                <div class="d-flex justify-content-between">
                                                    <a href="{% url 'profile' i.user.slug %}"><h4 class="fw-700 text-grey-900 font-xssss mt-1">{{ i.user.username }}
                                                        {% if i.user.verified %}
                                                            <i class="feather-check bg-success font-xs" style='border-radius:50px;'></i>
                                                        {% endif %}
                                                        {% if i.user.is_admin %}
                                                            <i class="feather-check  font-xs" style='border-radius:50px; background-color: #FDD017'></i>
                                                        {% endif %}
                                                    </h4></a>
                                                    <span class="font-xssss fw-500 text-grey-500">{{ i.updated_at|timesince }} ago</span>
                                                </div>
                                                <p class="fw-500 text-grey-800 font-xssss lh-20 mt-1 mb-0">{{ i.comment }}</p>
                                            </div>
                                        </div>
                                    {% endfor %}
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>            
    </div>
{% endblock body %} 